package bindgen

// Option represents a single configuration option for this package.
type Option interface {
	applyOption(*options) error
}

type optionFunc func(*options) error

func (f optionFunc) applyOption(opts *options) error {
	return f(opts)
}

type options struct {
	// generatedBy is the name of the program that generates code with this package.
	generatedBy string

	// world is the name of the WIT world to generate, e.g. "command" or "wasi:cli/command".
	// Default: all worlds in the Resolve will be generated.
	world string

	// packageRoot is the root Go package or module path used in generated code.
	packageRoot string

	// cmPackage is the package path to the "cm" or Component Model package with basic types.
	// Default: github.com/ydnar/wasm-tools-go/cm.
	cmPackage string

	// versioned determines if Go packages are generated with version numbers.
	versioned bool
}

func (opts *options) apply(o ...Option) error {
	for _, o := range o {
		err := o.applyOption(opts)
		if err != nil {
			return err
		}
	}
	return nil
}

// GeneratedBy returns an [Option] that specifies the name of the program or package
// that will appear in the "Code generated by ..." header on generated files.
func GeneratedBy(name string) Option {
	return optionFunc(func(opts *options) error {
		opts.generatedBy = name
		return nil
	})
}

// World returns an [Option] that specifies the WIT world to generate.
func World(world string) Option {
	return optionFunc(func(opts *options) error {
		opts.world = world
		return nil
	})
}

// PackageRoot returns an [Option] that specifies the root Go package path for generated Go packages.
func PackageRoot(path string) Option {
	return optionFunc(func(opts *options) error {
		opts.packageRoot = path
		return nil
	})
}

// CMPackage returns an [Option] that specifies the package path to the
// Component Model utility package (default: github.com/ydnar/wasm-tools-go/cm).
func CMPackage(path string) Option {
	return optionFunc(func(opts *options) error {
		opts.cmPackage = path
		return nil
	})
}

// Versioned returns an [Option] that specifies that all generated Go packages
// will have versions that match WIT versions.
func Versioned(versioned bool) Option {
	return optionFunc(func(opts *options) error {
		opts.versioned = versioned
		return nil
	})
}
